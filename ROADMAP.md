# 🚀 大厂面试级 IM 项目进阶路线图 (Roadmap to Big Tech)

这份清单旨在将目前的“即时通讯 Demo”升级为“生产级 IM 系统”，使其具备冲击腾讯、阿里等一线大厂前端岗位的竞争力。

## 📅 第一阶段：工程化与规范化 (基石)
**目标**：展示你具备大型项目的开发规范和类型安全意识，这是大厂的入场券。

- [ ] **迁移至 TypeScript (优先级：最高)**
    - [ ] 配置 `tsconfig.json` (严格模式 `strict: true`)。
    - [ ] 定义核心接口：`IUser`, `IMessage`, `IChatSession`。
    - [ ] 为所有组件和 Hooks 添加类型注解，杜绝 `any`。
- [ ] **引入代码规范工具**
    - [ ] 配置 **ESLint** + **Prettier** (遵循 Airbnb 或 Google 规范)。
    - [ ] 配置 **Husky** + **lint-staged**，在 commit 前自动检查代码。
- [ ] **架构分层优化**
    - [ ] 抽离 Service 层：将 Socket.IO 的逻辑从组件中剥离，封装为 `SocketService` 单例或自定义 Hook (`useSocket`)。
    - [ ] 抽离 API 层：使用 `axios` 封装 HTTP 请求，统一处理拦截器和错误。

## ⚡ 第二阶段：极致性能优化 (核心考点)
**目标**：解决 IM 场景下最核心的性能瓶颈，展示你对浏览器渲染原理的深度理解。

- [ ] **实现虚拟滚动 (Virtual Scrolling)**
    - [ ] **痛点**：解决 10万+ 消息列表导致的 DOM 爆炸和页面卡顿。
    - [ ] **方案**：引入 `react-virtuoso` 或 `react-window`。
    - [ ] **细节**：实现不定高度消息气泡的动态测量与渲染。
- [ ] **渲染性能调优**
    - [ ] 使用 `React.memo`, `useCallback`, `useMemo` 避免无关组件（如侧边栏、输入框）在消息接收时重新渲染。
    - [ ] 使用 **React DevTools Profiler** 生成优化前后的对比图，作为面试证据。
- [ ] **图片/媒体资源优化**
    - [ ] 实现图片懒加载 (Lazy Load)。
    - [ ] 图片上传前的本地压缩 (Canvas API)。

## 🛡️ 第三阶段：高可用与可靠性 (加分项)
**目标**：模拟真实网络环境，解决“消息丢了”、“发不出去”等极端情况，体现系统设计能力。

- [ ] **消息可靠投递机制 (ACK)**
    - [ ] 前端生成临时 ID (`tempId`)，消息发出后状态为 `sending` (转圈)。
    - [ ] 后端收到后回执 `ack`，前端更新状态为 `sent` (对勾)。
    - [ ] 超时未收到 ACK 自动重试 (Retry Strategy)。
- [ ] **断网重连与增量同步**
    - [ ] 监听 `online`/`offline` 事件，断网时暂停发送队列。
    - [ ] 重连成功后，携带本地最后一条消息的 ID (`lastMessageId`) 请求后端，拉取断线期间丢失的消息（Diff）。
- [ ] **乐观 UI (Optimistic UI)**
    - [ ] 发送消息时立即上屏，无需等待服务器响应，提升感官流畅度。

## 🧩 第四阶段：功能深度扩展 (亮点)
**目标**：增加业务复杂度，展示解决复杂交互问题的能力。

- [ ] **富文本与多媒体支持**
    - [ ] 支持发送图片、Emoji 表情。
    - [ ] 支持文件上传（带进度条）。
- [ ] **消息交互增强**
    - [ ] **消息撤回**：处理 2 分钟内撤回逻辑，前端替换为“xxx撤回了一条消息”。
    - [ ] **引用回复**：类似微信的引用功能。
- [ ] **未读消息管理**
    - [ ] 准确的未读数计数（Badge）。
    - [ ] 聊天列表按“最后更新时间”自动排序。

## 📝 第五阶段：面试准备 (软实力)
**目标**：将代码转化为能够口述的方法论。

- [ ] **撰写技术难点文档**
    - [ ] 记录“虚拟滚动遇到的坑”（如：图片加载导致高度塌陷怎么解？）。
    - [ ] 记录“Socket 连接断开的边界情况处理”。
- [ ] **准备 STAR 法则话术**
    - [ ] **S (Situation)**: 随着消息量增长，页面出现卡顿。
    - [ ] **T (Task)**: 需要优化长列表渲染性能。
    - [ ] **A (Action)**: 引入虚拟滚动，重构消息列表组件，优化 DOM 节点数。
    - [ ] **R (Result)**: 即使加载 10 万条消息，首屏渲染时间控制在 100ms 内，FPS 稳定在 60。

---

### 💡 建议执行顺序
1. **TypeScript 迁移** (最基础，必须先做)
2. **虚拟滚动** (最显眼，面试官必问)
3. **消息可靠性 ACK** (最能体现深度)
